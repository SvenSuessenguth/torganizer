<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html lang="en"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:cc="http://xmlns.jcp.org/jsf/composite"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:tc="http://xmlns.jcp.org/jsf/composite/components">

<head>
  <title>round robin chart</title>
</head>

<cc:interface name="rr-chart"
              displayName="rr-chart"
              preferred="true"
              expert="false"
              shortDescription="chart for a group playing round robin">

  <cc:attribute name="group" required="true" type="org.cc.torganizer.core.entities.Group"/>
</cc:interface>

<cc:implementation>
  <!--
   | Matches
   +-->
  <table class="rr-matches-table">
    <tr>
      <th class="rr-chart-header">&nbsp;</th>
      <c:forEach var="opponent" items="#{cc.attrs.group.opponents}">
        <th class="rr-chart-header">
          <tc:opponent opponent="#{opponent}" showLastNames="true"/>
        </th>
      </c:forEach>
    </tr>

    <c:forEach var="rowOpponent" items="#{cc.attrs.group.opponents}" varStatus="row">
      <tr>
        <th class="rr-chart-header">
          <tc:opponent opponent="#{rowOpponent}" showLastNames="true"/>
        </th>
        <!-- Opponents -->
        <c:forEach var="colOpponent" items="#{cc.attrs.group.opponents}" varStatus="col">
          <td class="#{(col.index le row.index) ? 'rr-matches-lower-bracket' : 'rr-matches-upper-bracket'}">
            <tc:results
              rendered="#{group.match(row.index*fn:length(group.opponents)+col.index)!=null}"
              results="#{group.match(row.index*fn:length(group.opponents)+col.index).results}"
              alignment="vertical"/>
          </td>
        </c:forEach>
      </tr>
    </c:forEach>
  </table>

  <!--
   | Chart
   +-->
  <table class="rr-chart-table">
    <tr>
      <th class="rr-chart-header">&nbsp;</th>
      <th class="rr-chart-header">gespielt</th>
      <th class="rr-chart-header">Spiele</th>
      <th class="rr-chart-header">Saetze</th>
      <th class="rr-chart-header">Punkte</th>
    </tr>
    <c:forEach var="aggregate" items="#{cc.attrs.group.aggregates}">
      <tr>
        <th class="rr-chart-header">
          <tc:opponent opponent="#{aggregate.opponent}" showLastNames="true" showFirstNames="true"/>
        </th>
        <td class="rr-chart-aggregate">#{aggregate.ma.wins+aggregate.ma.lose}</td>
        <td class="rr-chart-aggregate">#{aggregate.ma.wins}:#{aggregate.ma.lose}</td>
        <td class="rr-chart-aggregate">#{aggregate.ra.wins}:#{aggregate.ra.lose}</td>
        <td class="rr-chart-aggregate">#{aggregate.sa.wins}:#{aggregate.sa.lose}</td>
      </tr>
    </c:forEach>
  </table>

</cc:implementation>
</html>

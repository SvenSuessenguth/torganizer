pipeline {

  agent any

  options {
    buildDiscarder(logRotator(daysToKeepStr: '3', numToKeepStr: '3', artifactNumToKeepStr: '3'))
    durabilityHint('PERFORMANCE_OPTIMIZED')
  }

  tools {
    maven 'apache-maven-3.6'
  }

  stages {
    stage('jdks') {
      matrix {
        axes {
          axis {
            name 'jdkVersion'
            values 'openjdk-8'
          }
        }

        stages {
          stage('test') {
            tools {
             jdk "${jdkVersion}"
            }
            steps {
              execute("mvn compile test -T 4C")
            }
          }
        }
      }
    }
  }
}


void execute(instruction) {
  if (isUnix()) {
    sh instruction
  } else {
    bat instruction
  }
}